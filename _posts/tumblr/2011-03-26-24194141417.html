---
layout: post
title: 用PHP模拟HTTP的GET和POST操作
---

<p><strong>1.GET</strong></p>

<pre>&lt;?php 

$host = 'www.weizhifeng.net';

$fp = fsockopen($host, 80, $errno, $errstr, 30);

define('CRLF', "rn");

if (!$fp) {

    echo "$errstr ($errno) ";

} else {

	$body = '';

	$header  = 'GET /get.php HTTP/1.1' . CRLF;

	$header .= 'Host: ' . $host . CRLF;

	$header .= 'Accept: */*' . CRLF;

	$header .= 'Accept-Encoding: gzip, deflate' . CRLF;

	$header .= 'Connection: Close' . CRLF . CRLF;



	$out = $header . $body;

	fwrite($fp, $out);

	while (!feof($fp)) {

	    echo fgets($fp, 128);

	}

	fclose($fp);

}

?&gt;

</pre>

<p>2.以Content-Type: application/x-www-form-urlencoded方式POST提交普通表单(即表单中没有文件需要上传)</p>

<pre>&lt;?php 

$host = 'www.weizhifeng.net';

$fp = fsockopen($host, 80, $errno, $errstr, 30);

define('CRLF', "rn");

if (!$fp) {

    echo “$errstr ($errno)n”;

} else {

	$body = 'k1=v1&amp;k2=v2&amp;k3=v3';

	$length = strlen($body);

	$header  = 'POST /post.php HTTP/1.1' . CRLF;

	$header .= 'Host: ' . $host . CRLF;

	$header .= 'Accept: */*' . CRLF;

	$header .= 'Accept-Encoding: gzip, deflate' . CRLF;

	$header .= 'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' . CRLF;

	$header .= 'Content-Length: ' . $length . CRLF; //重要

	$header .= 'Connection: Close' . CRLF . CRLF;

	$out = $header . $body;



	fwrite($fp, $out);

    while (!feof($fp)) {

        echo fgets($fp, 128);

    }

    fclose($fp);

}

?&gt;

</pre>

<p>3. 以Content-Type: multipart/form-data方式POST提交普通表单(即表单中没有文件需要上传)</p>

<pre>&lt;?php 

$host = 'www.weizhifeng.net';

$fp = fsockopen($host, 80, $errno, $errstr, 30);

define('CRLF', "rn");

if (!$fp) {

    echo “$errstr ($errno)n”;

} else {

	define('BOUNDARY', 'jeremywei' . md5(uniqid(microtime())));//定义分界符

        //组装body

	$body  = '--' . BOUNDARY . CRLF;

	$body .= 'Content-Disposition: form-data; name="k1"' . CRLF . CRLF;

	$body .= 'v1' . CRLF;

	$body  = '--' . BOUNDARY . CRLF;

	$body .= 'Content-Disposition: form-data; name="k2"' . CRLF . CRLF;

	$body .= 'v2' . CRLF;

	$body .= '--' . BOUNDARY . '--' . CRLF; //body内容结束

	$length = strlen($body);



	$header  = 'POST /post.php' . ' HTTP/1.1' . CRLF;

	$header .= 'Host: ' . $host . CRLF;

	$header .= 'Accept: */*' . CRLF;

	$header .= 'Accept-Encoding: gzip, deflate' . CRLF;

	$header .= 'Content-Type: multipart/form-data; boundary=' . BOUNDARY . CRLF;

	$header .= 'Content-Length: ' . $length . CRLF;

	$header .= 'Connection: Close' . CRLF . CRLF;

	$out = $header . $body;



	fwrite($fp, $out);

    while (!feof($fp)) {

        echo fgets($fp, 128);

    }

    fclose($fp);

}

?&gt;

</pre>

<p>4. 以Content-Type: multipart/form-data方式POST提交包含文件的表单</p>

<pre>&lt;?php 

$host = 'www.weizhifeng.net';

$fp = fsockopen($host, 80, $errno, $errstr, 30);

define('CRLF', "rn");

if (!$fp) {

    echo “$errstr ($errno)n”;

} else {

	define('BOUNDARY', 'wei' . md5(uniqid(microtime())));

        //entity 分隔符	

        $body  = '--' . BOUNDARY . CRLF;     

        //entity1 header

        $body .= 'Content-Disposition: form-data; name="file"; filename="php.txt"' . CRLF; 

        //entity1 header 结束

        $body .= 'Content-Type: text/plain' . CRLF . CRLF;

        //entity1 body        

        $body .= 'filecontents...' . CRLF;                                                 

        //entity 分隔符

        $body .= '--' . BOUNDARY . CRLF;                                                   

        //entity2 header

        $body .= 'Content-Disposition: form-data; name="k1"' . CRLF . CRLF;

        //entity2 body                

        $body .= 'v1' . CRLF;                                                              

        //message body 结束

        $body .= '--' . BOUNDARY . '--' . CRLF;                                            



	$length = strlen($body);

	$header  = 'POST /post.php' . ' HTTP/1.1' . CRLF;

	$header .= 'Host: ' . $host . CRLF;

	$header .= 'Accept: */*' . CRLF;

	$header .= 'Accept-Encoding: gzip, deflate' . CRLF;

	$header .= 'Content-Type: multipart/form-data; boundary=' . BOUNDARY . CRLF;

	$header .= 'Content-Length: ' . $length . CRLF;

	$header .= 'Connection: Close' . CRLF . CRLF;



	fwrite($fp, $out);

    while (!feof($fp)) {

        echo fgets($fp, 128);

    }

    fclose($fp);

}

?&gt;

</pre>

<p>参考：<br/><a href="http://www.faqs.org/rfcs/rfc2616.html" target="_blank">http://www.faqs.org/rfcs/rfc2616.html</a></p>
