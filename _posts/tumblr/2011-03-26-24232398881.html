---
layout: post
title: Ubuntu + PHP + RabbitMQ配置
---

<p>RabbitMQ是一个开源的基于<a href="http://www.amqp.org/" target="_blank">AMQP</a>（Advanced Message Queuing Protocol）标准，并且可靠性高的企业级消息系统，目前很多网站在用，包括reddit,Poppen.de等。</p>

<p><strong>1. 安装RabbitMQ</strong></p>

<pre>sudo apt-get install rabbitmq-server

sudo /etc/init.d/rabbitmq-server start

</pre>

<p><strong>2. 安装librabbitmq</strong></p>

<pre>sudo apt-get install mercurial

hg clone <a href="http://hg.rabbitmq.com/rabbitmq-c" target="_blank">http://hg.rabbitmq.com/rabbitmq-c</a>

cd rabbitmq-c

hg clone <a href="http://hg.rabbitmq.com/rabbitmq-codegen" target="_blank">http://hg.rabbitmq.com/rabbitmq-codegen</a> codegen

autoreconf -i

./configure

sudo make

sudo make install

</pre>

<p>3. 安装php-rabbit扩展</p>

<pre>wget <a href="http://php-rabbit.googlecode.com/files/php-rabbit.r91.tar.gz" target="_blank">http://php-rabbit.googlecode.com/files/php-rabbit.r91.tar.gz</a>

tar -zxvf php-rabbit.r91.tar.gz

cd php-rabbit.r91

/path/to/php/bin/phpize

./configure --with-amqp --with-php-config=/path/to/php/bin/php-config

sudo make

sudo make install

</pre>

<p>编辑 php.ini 添加：</p>

<pre>extension=rabbit.so

</pre>

<p>输出phpinfo看下是否扩展已经加载成功,have fun:) <strong>4. Demo</strong></p>

<pre>&lt;?

//producer:

$params = array('host' =&gt; 'localhost',

                'port' =&gt; 5672,

                'login' =&gt; 'guest',

                'password' =&gt; 'guest',

                'vhost' =&gt; '/');

$cnn = new AMQPConnect($params);



// declare Exchange

$exchange = new AMQPExchange($cnn);

$exchange-&gt;declare('ex1', 'topic', AMQP_DURABLE );



// declare Queue

$queue = new AMQPQueue($cnn);

$queue-&gt;declare('queue1', AMQP_DURABLE);



// bind Queue

$queue-&gt;bind('ex1','wei.#');



// publishing

$msg = "msg";



for ($i=0; $i &lt; 100; $i++) {

	$res = $exchange-&gt;publish($i . 'msg', 'wei.' . $i);

	if ($res) {

		echo $i . 'msg' . " Yesn";

	} else {

		echo $i . 'msg' . " Non";

	}

}



// consumer:

$params = array('host' =&gt; 'localhost',

                'port' =&gt; 5672,

                'login' =&gt; 'guest',

                'password' =&gt; 'guest',

                'vhost' =&gt; '/');

$cnn = new AMQPConnect($params);



// create the Queue

$queue = new AMQPQueue($cnn, 'queue1');

$queueMessages = $queue-&gt;consume(100);



foreach($queueMessages as $item) {

	echo "$i.$itemn";

}

?&gt;

</pre>

<p>参考：<br/> <a href="http://www.rabbitmq.com/install.html" target="_blank">http://www.rabbitmq.com/install.html</a><br/> <a href="http://blog.ftofficer.com/2010/03/translation-rabbitmq-python-rabbits-and-warrens/" target="_blank">http://blog.ftofficer.com/2010/03/translation-rabbitmq-python-rabbits-and-warrens/</a><br/> <a href="http://code.google.com/p/php-rabbit/" target="_blank">http://code.google.com/p/php-rabbit/</a></p>
