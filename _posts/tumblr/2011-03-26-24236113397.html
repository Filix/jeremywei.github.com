---
layout: post
title: 用Diff和Patch给文件升级
---

<p>假设/path/to/a目录下有a.txt，b.txt两个文件(内容如下)，我们通过打补丁的方式把a.txt升级为b.txt。</p>

<pre>a/a.txt:

a

b

c



a/b.txt：

a

d

c

f

</pre>

<p>1. 创建补丁文件 利用diff命令来完成，更多的选项可以通过diff - -help查看</p>

<pre>diff -uN a/a.txt b/b.txt &lt; a.patch

</pre>

<p>2. 补丁文件格式</p>

<pre>--- a/a.txt

+++ a/b.txt

@@ -1,3 +1,4 @@

 a

-b

+d

 c

+f

</pre>

<p>- - - a/a.txt // - - -表示旧文件</p>

<p>+++ a/b.txt // +++表示新文件</p>

<p>@@ -1,3 +1,4 @@</p>

<p>// 内容变更区域</p>

<p>// -1,3 表示旧文件(a.txt)的变更区域，从第1行开始，变动的行数是3，即1到3行会有变化</p>

<p>// +1,4 表示新文件(b.txt)的变更区域，从第1行开始，变动的行数是4，即1到4行会有变化</p>

<p>// + 表示添加新的一行 +d表示添加了一行，内容是&#8221;d&#8221;</p>

<p>// - 表示删除了这一行 -b表示删除了b这一行</p>

<p>3. 打补丁 利用patch命令来完成，参数可以通过patch - -help查看，常用方式有两种：</p>

<p>如果使用参数-p0，那就表示直接用补丁文件中的路径来查找文件(即a/a.txt)来进行patch操作，如果我们在/path/to目录下，我们如下打补丁：</p>

<pre>patch -p0 &lt; a.patch

</pre>

<p>如果使用参数-p1，那就表示忽略补丁文件中的第一层目录(即a/a.txt中的a)，从当前目录中直接查找a.txt来进行patch操作，如果我们在/path/to/a目录下，我们如下打补丁：</p>

<pre>patch -p1 &lt; a.patch

</pre>

<p>打好补丁以后，我们来看a.txt文件的内容：</p>

<pre>a

d

c

f

</pre>

<p>以上只是一个小小的demo，复杂的情况还需要去深入研究:)</p>

<p>参考：http://en.wikipedia.org/wiki/Diff</p>
