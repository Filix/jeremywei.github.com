---
layout: post
title: PHP的SSH2扩展安装
---

<p>想要在php程序中执行scp拷贝，之前想用system函数system(&#8220;scp /from/path/file user@des_host:/to/path/file&#8221;)，但是始终失败，但在命令行下直接执行scp /from/path/file user@des_host:/to/path/file 是OK的，至今找不到原因，如果哪位知道原因，麻烦告知一下。既然这个方法不行，就换吧，不能一棵树吊死啊。</p>

<p>google来,google去，发现原来php里有现成的函数： <a href="http://us2.php.net/manual/en/book.ssh2.php" target="_blank"><a href="http://us2.php.net/manual/en/book.ssh2.php" target="_blank">http://us2.php.net/manual/en/book.ssh2.php</a></a>，只是要装几个包。</p>

<p>方法如下： <a href="http://us2.php.net/manual/en/ssh2.installation.php" target="_blank"><a href="http://us2.php.net/manual/en/ssh2.installation.php" target="_blank">http://us2.php.net/manual/en/ssh2.installation.php</a></a></p>

<p>首先要装OpenSSL。 因为自己OpenSSL已经装过了，所以直接第二步，下个libssh2直接安装。 我下的是libssh2-0.18,这个都没什么问题。 第三步要用pear安装php的ssh扩展，如果没装pear可以直接下载源码，自己编译。 <a href="http://pecl.php.net/package/ssh2" target="_blank"><a href="http://pecl.php.net/package/ssh2" target="_blank">http://pecl.php.net/package/ssh2</a></a>我下的ssh2-0.10.tgz，解压，编译：</p>

<pre>tar -zxvf ssh2-0.10.tgz

</pre>

<p>注意源码有些问题，要修改： 把480行</p>

<pre>#if LIBSSH2_APINO &lt; 200412301450

…

#else

</pre>

<p>改为</p>

<pre>#if (defined(LIBSSH2_APINO) &amp;&amp; LIBSSH2_APINO&lt; 200412301450)

…

#else

</pre>

<p>把1216行:</p>

<pre>#if (LIBSSH2_APINO &amp;gt; 200503221619)

</pre>

<p>改为</p>

<pre>#if (defined(LIBSSH2_APINO) &amp;amp;&amp;amp; (LIBSSH2_APINO &amp;gt; 200503221619)) ||

(defined(LIBSSH2_VERSION_NUM) &amp;amp;&amp;amp; LIBSSH2_VERSION_NUM &amp;gt;= 0×001000)

</pre>

<pre>cd ssh2-0.10

phpize 

./configure --with-ssh2 --with-phpconfig=/xxx/phpconfig 

make

make install

</pre>

<p>重启Apache。</p>
