---
layout: post
title: PHP5.2.9+Apache2+Fastcgi+php-fpm配置
---

<p>PHP5.3的配置请看最新版：<a href="/post/24233790265/php5-3-apache2-fastcgi-php-fpm" target="_blank">PHP5.3+Apache2+Fastcgi+php-fpm配置</a></p>

<h2>1.安装Apache2的<a href="http://www.fastcgi.com/dist/mod_fastcgi-current.tar.gz" target="_blank">mod_fastcgi</a></h2>

<pre>tar -zxvf mod_fastcgi

cd mod_fastcgi

cp Makefile.AP2 Makefile

make top_dir=/path/to/apache2#你的Apache安装路径

make install

</pre>

<p>vi httpd.conf 增加如下配置：</p>

<pre>LoadModule fastcgi_module modules/mod_fastcgi.so

</pre>

<h2>2.以<a href="http://www.fastcgi.com/drupal/node/2" target="_blank">fastcgi</a>模式安装<a href="http://www.php.net/" target="_blank">PHP</a></h2>

<p>下载<a href="http://php-fpm.org/downloads/" target="_blank">php-fpm</a>，然后给php源码打上补丁：</p>

<pre>gzip -cd php-5.2.9-fpm-0.5.10-unofficial.diff.gz | patch -d php-5.2.9 -p1

</pre>

<p>编译PHP，这个步骤和普通PHP安装一样，只是把“&#8212;with-apxs2”选项去掉，替换成“&#8212;enable-fastcgi &#8212;enable-fpm”。这样编译后，在PHP的bin目录下的php-cgi就是fastcgi模式的php解释器了，PHP的sbin下的 php-fpm就是fastcgi的管理器了。</p>

<h2>3.配置Apache</h2>

<pre>cd /var

mkdir fcgi-bin

cd fcgi-bin

ln -s php-cgi /path/to/php/bin/php-cgi #你的php-cgi路径，其中要注意权限问题。

</pre>

<p>如果用Apache的内部的<a href="http://www.fastcgi.com/mod_fastcgi/docs/mod_fastcgi.html" target="_blank">fpm</a>(fastcgi process manager)，则： 修改httpd.conf 添加如下配置：</p>

<pre>ScriptAlias /fcgi-bin/ "/var/fcgi-bin/" #定义目录映射

FastCgiServer /var/fcgi-bin/php-cgi -processes 10 #配置fastcgi server，

SetHandler fastcgi-script

Options FollowSymLinks

Order allow,deny

Allow from all



AddType application/x-httpd-php .php  #增加MIME类型

AddHandler php-fastcgi .php          #.php结尾的请求都要用php-fastcgi来处理

Action php-fastcgi /fcgi-bin/php-cgi #设置php-fastcgi的处理器

</pre>

<p>如果用<a href="http://php-fpm.org/CN:Home" target="_blank">php-fpm</a>来管理cgi的话，则： 修改httpd.conf 添加如下配置：</p>

<pre>ScriptAlias /fcgi-bin/ "/var/fcgi-bin/" #定义目录映射

FastCgiExternalServer /var/fcgi-bin/php-cgi -host 127.0.0.1:9000

#配置fastcgi外部server，127.0.0.1:9000地址为php-fpm的监听地址。



SetHandler fastcgi-script

Options FollowSymLinks

Order allow,deny

Allow from all



AddType application/x-httpd-php .php  #增加MIME类型

AddHandler php-fastcgi .php          #.php结尾的请求都要用php-fastcgi来处理

Action php-fastcgi /fcgi-bin/php-cgi #设置php-fastcgi的处理器

</pre>

<p>使用php-fpm是有很多<a href="http://www.yeead.com/archives/shiyongphp-fpmlaipinghuabiangengfastcgimoshixiadephpshezhi" target="_blank">优点</a>的，比如可以平滑地重新加载php.ini文件而不用重启fastcgi进程，对于访问量大的网站来说是很重要的。</p>

<h2>4.重启Apache</h2>

<p>重启Apache，查看phpinfo，如果服务器信息是： Apache/2.2.11 (Unix) mod_fastcgi/2.4.6之类的就说明安装成功了。 如果出现403的错误，查看下/var/fcgi-bin/是否有足够的权限。</p>

<p>ps aux|grep php-cgi可以看见N个cgi进程在跑。</p>
