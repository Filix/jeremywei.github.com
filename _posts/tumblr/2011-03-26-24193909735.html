---
layout: post
title: PHP_SELF，SCRIPT_NAME，SCRIPT_FILENAME，PATH_INFO，REQUEST_URI的区别
---

<p>PHP的$_SERVER中五个和路径相关的变量PHP_SELF，SCRIPT_NAME，SCRIPT_FILENAME，PATH_INFO，REQUEST_URI经常会被混淆，做下区分：</p>

<p><strong>测试环境</strong></p>

<p>Nginx0.8.54+Fastcgi+PHP5.3.4，要先配置Nginx的PATH_INFO，在nginx.conf中加入如下配置：</p>

<pre>location ~ .*.php {

    fastcgi_pass   127.0.0.1:9000;

    fastcgi_index  index.php;



    #从$fastcgi_script_name中分离出真正执行的脚本名称和PATH_INFO

    set $real_script_name $fastcgi_script_name;

    if ($fastcgi_script_name ~ "^(.+?.php)(/.+)$") {

        set $real_script_name $1;

        set $path_info $2;

     }

    #重新设置SCRIPT_FILENAME

    fastcgi_param SCRIPT_FILENAME $document_root$real_script_name;

    fastcgi_param  QUERY_STRING       $query_string;

    fastcgi_param  REQUEST_METHOD     $request_method;

    fastcgi_param  CONTENT_TYPE       $content_type;

    fastcgi_param  CONTENT_LENGTH     $content_length;



    #重新设置SCRIPT_NAME

    fastcgi_param SCRIPT_NAME $real_script_name;

    fastcgi_param PATH_INFO $path_info;

    fastcgi_param  REQUEST_URI        $request_uri;

    fastcgi_param  DOCUMENT_URI       $document_uri;

    fastcgi_param  DOCUMENT_ROOT      $document_root;

    fastcgi_param  SERVER_PROTOCOL    $server_protocol;



    fastcgi_param  GATEWAY_INTERFACE  CGI/1.1;

    fastcgi_param  SERVER_SOFTWARE    nginx/$nginx_version;



    fastcgi_param  REMOTE_ADDR        $remote_addr;

    fastcgi_param  REMOTE_PORT        $remote_port;

    fastcgi_param  SERVER_ADDR        $server_addr;

    fastcgi_param  SERVER_PORT        $server_port;

    fastcgi_param  SERVER_NAME        $server_name;



    # PHP only, required if PHP was built with --enable-force-cgi-redirect

    fastcgi_param  REDIRECT_STATUS    200;

}

</pre>

<p>我们的根目录为/var/www，测试域名为example.com(不过这个域名只能改hosts文件YY一下了)，结构如下：</p>

<pre>var

 |---www

       |---test

             |---test.php

</pre>

<p><strong>测试脚本：</strong></p>

<pre>&lt;?php

    echo 'SCRIPT_NAME=' . $_SERVER['SCRIPT_NAME'] . '&lt;br /&gt;';

    echo 'SCRIPT_FILENAME=' . $_SERVER['SCRIPT_FILENAME'] . '&lt;br /&gt;';

    echo 'PATH_INFO=' . $_SERVER['PATH_INFO'] . '&lt;br /&gt;';

    echo 'REQUEST_URI=' . $_SERVER['REQUEST_URI'] . '&lt;br /&gt;';

?&gt;

</pre>

<p><strong>测试结果：</strong></p>

<ul><li>PHP_SELF: 当前所执行的脚本的文件名，这个值是相对于根目录来说。如果请求http://example.com/test/test.php?k=v，则PHP_SELF的值为/test/test.php。</li>

<li>SCRIPT_NAME： 当前执行的脚本的路径，如果请求http://example.com/test/test.php?k=v，则SCRIPT_NAME的值为/test/test.php。这个变量是在CGI/1.1中定义的。</li>

<li>SCRIPT_FILENAME： 当前执行的脚本的绝对路径，如果请求http://example.com/test/test.php?k=v，则SCRIPT_FILENAME的值 为/var/www/test/test.php。注意：如果一个脚本以相对路径，CLI方式来执行，例如../test/test.php，那 么$_SERVER[&#8216;SCRIPT_FILENAME&#8217;] 的值为相对路径，即../test/test.php。</li>

<li>PATH_INFO： 客户端提供的路径信息，即在实际执行脚本后面尾随的内容，但是会去掉query string。如果请求http://example.com/test/test.php/a/b?k=v，则PATH_INFO的值为/a/b。CGI标准中如下描述： “The PATH_INFO string is the trailing part of thecomponent of the script URI that follows the SCRIPT_NAME part of the path.”</li>

<li>REQUEST_URI： 包含HTTP协议中定义的URI内容。如果请求http://example.com/test/test.php?k=v，则REQUEST_URI为/test/test.php?k=v</li>

</ul><p><strong>区别：</strong></p>

<ul><li>PHP_SELF VS SCRIPT_NAME： PHP_SELF和SCRIPT_NAME的值在大部分情况下都是一样的，但是访问http://example.com/test/test.php/a/b?k=v这类URL时候，PHP_SELF为<strong>/test/test.php/a/b</strong>，SCRIPT_NAME为<strong>/test/test.php</strong>，可以看出PHP_SELF比SCRIPT_NAME多了PATH_INFO的内容。</li>

<li>REQUEST_URI VS SCRIPT_NAME： 在访问http://example.com/test/test.php?k=v后，REQUEST_URI为/test /test.php?k=v，SCRIPT_NAME为/test/test.php，可以看出REQUEST_URI比SCRIPT_NAME多了 query string。 如果http://example.com/test/test.php在服务器端做了rewrite： rewrite /test/test.php /test/test2.php; 那么REQUEST_URI为<strong>/test/test.php</strong>，SCRIPT_NAME为<strong>/test/test2.php</strong>。</li>

</ul><p>参考： <br/><a href="http://tools.ietf.org/html/draft-robinson-www-interface-00" target="_blank">http://tools.ietf.org/html/draft-robinson-www-interface-00</a><br/> <a href="http://stackoverflow.com/questions/279966/php-self-vs-path-info-vs-script-name-vs-request-uri" target="_blank">http://stackoverflow.com/questions/279966/php-self-vs-path-info-vs-script-name-vs-request-uri</a><br/> <a href="http://ca.php.net/manual/en/reserved.variables.server.php" target="_blank">http://ca.php.net/manual/en/reserved.variables.server.php</a></p>
